"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.LambdaStack = void 0;
const cdk = require("aws-cdk-lib");
const lambda = require("aws-cdk-lib/aws-lambda");
const path = require("path");
class LambdaStack extends cdk.Stack {
    constructor(scope, id, props) {
        super(scope, id, props);
        const { moviesBucket, moviesDataTable, subscriptionsDataTable, movieRatingsTable } = props;
        this.uploadMovieFn = new lambda.Function(this, "uploadMovieFn", {
            runtime: lambda.Runtime.NODEJS_20_X,
            handler: "index.handler",
            code: lambda.Code.fromAsset(path.join(__dirname, "./src/upload-movie")),
            environment: {
                S3_BUCKET: moviesBucket.bucketName,
                DYNAMODB_TABLE: moviesDataTable.tableName,
            },
        });
        this.downloadMovieFn = new lambda.Function(this, "downloadMovieFn", {
            runtime: lambda.Runtime.NODEJS_20_X,
            handler: "index.handler",
            code: lambda.Code.fromAsset(path.join(__dirname, "./src/download-movie")),
            environment: {
                S3_BUCKET: moviesBucket.bucketName,
                DYNAMODB_TABLE: moviesDataTable.tableName,
            },
        });
        this.getSingleMovieFn = new lambda.Function(this, "getSingleMovieFn", {
            runtime: lambda.Runtime.NODEJS_20_X,
            handler: "index.handler",
            code: lambda.Code.fromAsset(path.join(__dirname, "./src/get-single-movie")),
            environment: {
                S3_BUCKET: moviesBucket.bucketName,
                DYNAMODB_TABLE: moviesDataTable.tableName,
                RATINGS_TABLE: movieRatingsTable.tableName
            },
        });
        this.getMoviesFn = new lambda.Function(this, "getMoviesFn", {
            runtime: lambda.Runtime.NODEJS_20_X,
            handler: "index.handler",
            code: lambda.Code.fromAsset(path.join(__dirname, "./src/get-movies")),
            environment: {
                S3_BUCKET: moviesBucket.bucketName,
                DYNAMODB_TABLE: moviesDataTable.tableName,
            },
        });
        this.deleteMovieFn = new lambda.Function(this, "deleteMovieFn", {
            runtime: lambda.Runtime.NODEJS_20_X,
            handler: "index.handler",
            code: lambda.Code.fromAsset(path.join(__dirname, "./src/delete-movie")),
            environment: {
                S3_BUCKET: moviesBucket.bucketName,
                DYNAMODB_TABLE: moviesDataTable.tableName,
            },
            timeout: cdk.Duration.seconds(10),
        });
        this.subscribeFn = new lambda.Function(this, "subscribeFn", {
            runtime: lambda.Runtime.NODEJS_20_X,
            handler: "index.handler",
            code: lambda.Code.fromAsset(path.join(__dirname, "./src/subscribe")),
            environment: {
                DYNAMODB_TABLE: subscriptionsDataTable.tableName,
            },
        });
        this.getSubscriptionsFn = new lambda.Function(this, "getSubscriptionsFn", {
            runtime: lambda.Runtime.NODEJS_20_X,
            handler: "index.handler",
            code: lambda.Code.fromAsset(path.join(__dirname, "./src/get-subscriptions")),
            environment: {
                DYNAMODB_TABLE: subscriptionsDataTable.tableName,
            },
        });
        this.unsubscribeFn = new lambda.Function(this, "unsubscribeFn", {
            runtime: lambda.Runtime.NODEJS_20_X,
            handler: "index.handler",
            code: lambda.Code.fromAsset(path.join(__dirname, "./src/unsubscribe")),
            environment: {
                DYNAMODB_TABLE: subscriptionsDataTable.tableName,
            },
        });
        this.editMovieFn = new lambda.Function(this, "editMovieFn", {
            runtime: lambda.Runtime.NODEJS_20_X,
            handler: "index.handler",
            code: lambda.Code.fromAsset(path.join(__dirname, "./src/edit-movie")),
            environment: {
                S3_BUCKET: moviesBucket.bucketName,
                DYNAMODB_TABLE: moviesDataTable.tableName,
            },
        });
        this.rateMovieFn = new lambda.Function(this, "rateMovieFn", {
            runtime: lambda.Runtime.NODEJS_20_X,
            handler: "index.handler",
            code: lambda.Code.fromAsset(path.join(__dirname, "./src/rate-movie")),
            environment: {
                MOVIE_RATINGS_TABLE: movieRatingsTable.tableName,
            },
        });
        moviesBucket.grantRead(this.downloadMovieFn);
        moviesBucket.grantRead(this.getMoviesFn);
        moviesBucket.grantRead(this.getSingleMovieFn);
        moviesBucket.grantReadWrite(this.uploadMovieFn);
        moviesBucket.grantReadWrite(this.deleteMovieFn);
        moviesBucket.grantReadWrite(this.editMovieFn);
        moviesDataTable.grantReadData(this.downloadMovieFn);
        moviesDataTable.grantReadData(this.getSingleMovieFn);
        moviesDataTable.grantReadData(this.getMoviesFn);
        moviesDataTable.grantReadWriteData(this.uploadMovieFn);
        moviesDataTable.grantReadWriteData(this.deleteMovieFn);
        moviesDataTable.grantReadWriteData(this.editMovieFn);
        subscriptionsDataTable.grantWriteData(this.subscribeFn);
        subscriptionsDataTable.grantReadData(this.getSubscriptionsFn);
        subscriptionsDataTable.grantWriteData(this.unsubscribeFn);
        movieRatingsTable.grantReadWriteData(this.rateMovieFn);
        movieRatingsTable.grantReadData(this.getSingleMovieFn);
    }
}
exports.LambdaStack = LambdaStack;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibGFtYmRhLXN0YWNrLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsibGFtYmRhLXN0YWNrLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7OztBQUFBLG1DQUFtQztBQUVuQyxpREFBaUQ7QUFHakQsNkJBQThCO0FBUzlCLE1BQWEsV0FBWSxTQUFRLEdBQUcsQ0FBQyxLQUFLO0lBWXhDLFlBQVksS0FBZ0IsRUFBRSxFQUFVLEVBQUUsS0FBd0I7UUFDaEUsS0FBSyxDQUFDLEtBQUssRUFBRSxFQUFFLEVBQUUsS0FBSyxDQUFDLENBQUM7UUFFeEIsTUFBTSxFQUFFLFlBQVksRUFBRSxlQUFlLEVBQUUsc0JBQXNCLEVBQUUsaUJBQWlCLEVBQUUsR0FBRyxLQUFNLENBQUM7UUFFNUYsSUFBSSxDQUFDLGFBQWEsR0FBRyxJQUFJLE1BQU0sQ0FBQyxRQUFRLENBQUMsSUFBSSxFQUFFLGVBQWUsRUFBRTtZQUM5RCxPQUFPLEVBQUUsTUFBTSxDQUFDLE9BQU8sQ0FBQyxXQUFXO1lBQ25DLE9BQU8sRUFBRSxlQUFlO1lBQ3hCLElBQUksRUFBRSxNQUFNLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLFNBQVMsRUFBRSxvQkFBb0IsQ0FBQyxDQUFDO1lBQ3ZFLFdBQVcsRUFBRTtnQkFDWCxTQUFTLEVBQUUsWUFBWSxDQUFDLFVBQVU7Z0JBQ2xDLGNBQWMsRUFBRSxlQUFlLENBQUMsU0FBUzthQUMxQztTQUNGLENBQUMsQ0FBQztRQUVILElBQUksQ0FBQyxlQUFlLEdBQUcsSUFBSSxNQUFNLENBQUMsUUFBUSxDQUFDLElBQUksRUFBRSxpQkFBaUIsRUFBRTtZQUNsRSxPQUFPLEVBQUUsTUFBTSxDQUFDLE9BQU8sQ0FBQyxXQUFXO1lBQ25DLE9BQU8sRUFBRSxlQUFlO1lBQ3hCLElBQUksRUFBRSxNQUFNLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLFNBQVMsRUFBRSxzQkFBc0IsQ0FBQyxDQUFD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QyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAqIGFzIGNkayBmcm9tIFwiYXdzLWNkay1saWJcIjtcclxuaW1wb3J0IHsgQ29uc3RydWN0IH0gZnJvbSBcImNvbnN0cnVjdHNcIjtcclxuaW1wb3J0ICogYXMgbGFtYmRhIGZyb20gXCJhd3MtY2RrLWxpYi9hd3MtbGFtYmRhXCI7XHJcbmltcG9ydCAqIGFzIGR5bmFtb2RiIGZyb20gXCJhd3MtY2RrLWxpYi9hd3MtZHluYW1vZGJcIjtcclxuaW1wb3J0ICogYXMgczMgZnJvbSBcImF3cy1jZGstbGliL2F3cy1zM1wiO1xyXG5pbXBvcnQgcGF0aCA9IHJlcXVpcmUoXCJwYXRoXCIpO1xyXG5cclxuZXhwb3J0IGludGVyZmFjZSBMYW1iZGFTdGFja1Byb3BzIGV4dGVuZHMgY2RrLlN0YWNrUHJvcHMge1xyXG4gIG1vdmllc0RhdGFUYWJsZTogZHluYW1vZGIuVGFibGU7XHJcbiAgc3Vic2NyaXB0aW9uc0RhdGFUYWJsZTogZHluYW1vZGIuVGFibGU7XHJcbiAgbW92aWVzQnVja2V0OiBzMy5CdWNrZXQ7XHJcbiAgbW92aWVSYXRpbmdzVGFibGU6IGR5bmFtb2RiLlRhYmxlO1xyXG59XHJcblxyXG5leHBvcnQgY2xhc3MgTGFtYmRhU3RhY2sgZXh0ZW5kcyBjZGsuU3RhY2sge1xyXG4gIHB1YmxpYyByZWFkb25seSB1cGxvYWRNb3ZpZUZuOiBsYW1iZGEuRnVuY3Rpb247XHJcbiAgcHVibGljIHJlYWRvbmx5IGRvd25sb2FkTW92aWVGbjogbGFtYmRhLkZ1bmN0aW9uO1xyXG4gIHB1YmxpYyByZWFkb25seSBnZXRTaW5nbGVNb3ZpZUZuOiBsYW1iZGEuRnVuY3Rpb247XHJcbiAgcHVibGljIHJlYWRvbmx5IGdldE1vdmllc0ZuOiBsYW1iZGEuRnVuY3Rpb247XHJcbiAgcHVibGljIHJlYWRvbmx5IGRlbGV0ZU1vdmllRm46IGxhbWJkYS5GdW5jdGlvbjtcclxuICBwdWJsaWMgcmVhZG9ubHkgc3Vic2NyaWJlRm46IGxhbWJkYS5GdW5jdGlvbjtcclxuICBwdWJsaWMgcmVhZG9ubHkgZ2V0U3Vic2NyaXB0aW9uc0ZuOiBsYW1iZGEuRnVuY3Rpb247XHJcbiAgcHVibGljIHJlYWRvbmx5IHVuc3Vic2NyaWJlRm46IGxhbWJkYS5GdW5jdGlvbjtcclxuICBwdWJsaWMgcmVhZG9ubHkgZWRpdE1vdmllRm46IGxhbWJkYS5GdW5jdGlvbjtcclxuICBwdWJsaWMgcmVhZG9ubHkgcmF0ZU1vdmllRm46IGxhbWJkYS5GdW5jdGlvbjtcclxuXHJcbiAgY29uc3RydWN0b3Ioc2NvcGU6IENvbnN0cnVjdCwgaWQ6IHN0cmluZywgcHJvcHM/OiBMYW1iZGFTdGFja1Byb3BzKSB7XHJcbiAgICBzdXBlcihzY29wZSwgaWQsIHByb3BzKTtcclxuXHJcbiAgICBjb25zdCB7IG1vdmllc0J1Y2tldCwgbW92aWVzRGF0YVRhYmxlLCBzdWJzY3JpcHRpb25zRGF0YVRhYmxlLCBtb3ZpZVJhdGluZ3NUYWJsZSB9ID0gcHJvcHMhO1xyXG5cclxuICAgIHRoaXMudXBsb2FkTW92aWVGbiA9IG5ldyBsYW1iZGEuRnVuY3Rpb24odGhpcywgXCJ1cGxvYWRNb3ZpZUZuXCIsIHtcclxuICAgICAgcnVudGltZTogbGFtYmRhLlJ1bnRpbWUuTk9ERUpTXzIwX1gsXHJcbiAgICAgIGhhbmRsZXI6IFwiaW5kZXguaGFuZGxlclwiLFxyXG4gICAgICBjb2RlOiBsYW1iZGEuQ29kZS5mcm9tQXNzZXQocGF0aC5qb2luKF9fZGlybmFtZSwgXCIuL3NyYy91cGxvYWQtbW92aWVcIikpLFxyXG4gICAgICBlbnZpcm9ubWVudDoge1xyXG4gICAgICAgIFMzX0JVQ0tFVDogbW92aWVzQnVja2V0LmJ1Y2tldE5hbWUsXHJcbiAgICAgICAgRFlOQU1PREJfVEFCTEU6IG1vdmllc0RhdGFUYWJsZS50YWJsZU5hbWUsXHJcbiAgICAgIH0sXHJcbiAgICB9KTtcclxuXHJcbiAgICB0aGlzLmRvd25sb2FkTW92aWVGbiA9IG5ldyBsYW1iZGEuRnVuY3Rpb24odGhpcywgXCJkb3dubG9hZE1vdmllRm5cIiwge1xyXG4gICAgICBydW50aW1lOiBsYW1iZGEuUnVudGltZS5OT0RFSlNfMjBfWCxcclxuICAgICAgaGFuZGxlcjogXCJpbmRleC5oYW5kbGVyXCIsXHJcbiAgICAgIGNvZGU6IGxhbWJkYS5Db2RlLmZyb21Bc3NldChwYXRoLmpvaW4oX19kaXJuYW1lLCBcIi4vc3JjL2Rvd25sb2FkLW1vdmllXCIpKSxcclxuICAgICAgZW52aXJvbm1lbnQ6IHtcclxuICAgICAgICBTM19CVUNLRVQ6IG1vdmllc0J1Y2tldC5idWNrZXROYW1lLFxyXG4gICAgICAgIERZTkFNT0RCX1RBQkxFOiBtb3ZpZXNEYXRhVGFibGUudGFibGVOYW1lLFxyXG4gICAgICB9LFxyXG4gICAgfSk7XHJcblxyXG4gICAgdGhpcy5nZXRTaW5nbGVNb3ZpZUZuID0gbmV3IGxhbWJkYS5GdW5jdGlvbih0aGlzLCBcImdldFNpbmdsZU1vdmllRm5cIiwge1xyXG4gICAgICBydW50aW1lOiBsYW1iZGEuUnVudGltZS5OT0RFSlNfMjBfWCxcclxuICAgICAgaGFuZGxlcjogXCJpbmRleC5oYW5kbGVyXCIsXHJcbiAgICAgIGNvZGU6IGxhbWJkYS5Db2RlLmZyb21Bc3NldChwYXRoLmpvaW4oX19kaXJuYW1lLCBcIi4vc3JjL2dldC1zaW5nbGUtbW92aWVcIikpLFxyXG4gICAgICBlbnZpcm9ubWVudDoge1xyXG4gICAgICAgIFMzX0JVQ0tFVDogbW92aWVzQnVja2V0LmJ1Y2tldE5hbWUsXHJcbiAgICAgICAgRFlOQU1PREJfVEFCTEU6IG1vdmllc0RhdGFUYWJsZS50YWJsZU5hbWUsXHJcbiAgICAgICAgUkFUSU5HU19UQUJMRTogbW92aWVSYXRpbmdzVGFibGUudGFibGVOYW1lXHJcbiAgICAgIH0sXHJcbiAgICB9KTtcclxuXHJcbiAgICB0aGlzLmdldE1vdmllc0ZuID0gbmV3IGxhbWJkYS5GdW5jdGlvbih0aGlzLCBcImdldE1vdmllc0ZuXCIsIHtcclxuICAgICAgcnVudGltZTogbGFtYmRhLlJ1bnRpbWUuTk9ERUpTXzIwX1gsXHJcbiAgICAgIGhhbmRsZXI6IFwiaW5kZXguaGFuZGxlclwiLFxyXG4gICAgICBjb2RlOiBsYW1iZGEuQ29kZS5mcm9tQXNzZXQocGF0aC5qb2luKF9fZGlybmFtZSwgXCIuL3NyYy9nZXQtbW92aWVzXCIpKSxcclxuICAgICAgZW52aXJvbm1lbnQ6IHtcclxuICAgICAgICBTM19CVUNLRVQ6IG1vdmllc0J1Y2tldC5idWNrZXROYW1lLFxyXG4gICAgICAgIERZTkFNT0RCX1RBQkxFOiBtb3ZpZXNEYXRhVGFibGUudGFibGVOYW1lLFxyXG4gICAgICB9LFxyXG4gICAgfSk7XHJcblxyXG4gICAgdGhpcy5kZWxldGVNb3ZpZUZuID0gbmV3IGxhbWJkYS5GdW5jdGlvbih0aGlzLCBcImRlbGV0ZU1vdmllRm5cIiwge1xyXG4gICAgICBydW50aW1lOiBsYW1iZGEuUnVudGltZS5OT0RFSlNfMjBfWCxcclxuICAgICAgaGFuZGxlcjogXCJpbmRleC5oYW5kbGVyXCIsXHJcbiAgICAgIGNvZGU6IGxhbWJkYS5Db2RlLmZyb21Bc3NldChwYXRoLmpvaW4oX19kaXJuYW1lLCBcIi4vc3JjL2RlbGV0ZS1tb3ZpZVwiKSksXHJcbiAgICAgIGVudmlyb25tZW50OiB7XHJcbiAgICAgICAgUzNfQlVDS0VUOiBtb3ZpZXNCdWNrZXQuYnVja2V0TmFtZSxcclxuICAgICAgICBEWU5BTU9EQl9UQUJMRTogbW92aWVzRGF0YVRhYmxlLnRhYmxlTmFtZSxcclxuICAgICAgfSxcclxuICAgICAgdGltZW91dDogY2RrLkR1cmF0aW9uLnNlY29uZHMoMTApLFxyXG4gICAgfSk7XHJcblxyXG4gICAgdGhpcy5zdWJzY3JpYmVGbiA9IG5ldyBsYW1iZGEuRnVuY3Rpb24odGhpcywgXCJzdWJzY3JpYmVGblwiLCB7XHJcbiAgICAgIHJ1bnRpbWU6IGxhbWJkYS5SdW50aW1lLk5PREVKU18yMF9YLFxyXG4gICAgICBoYW5kbGVyOiBcImluZGV4LmhhbmRsZXJcIixcclxuICAgICAgY29kZTogbGFtYmRhLkNvZGUuZnJvbUFzc2V0KHBhdGguam9pbihfX2Rpcm5hbWUsIFwiLi9zcmMvc3Vic2NyaWJlXCIpKSxcclxuICAgICAgZW52aXJvbm1lbnQ6IHtcclxuICAgICAgICBEWU5BTU9EQl9UQUJMRTogc3Vic2NyaXB0aW9uc0RhdGFUYWJsZS50YWJsZU5hbWUsXHJcbiAgICAgIH0sXHJcbiAgICB9KTtcclxuXHJcbiAgICB0aGlzLmdldFN1YnNjcmlwdGlvbnNGbiA9IG5ldyBsYW1iZGEuRnVuY3Rpb24odGhpcywgXCJnZXRTdWJzY3JpcHRpb25zRm5cIiwge1xyXG4gICAgICBydW50aW1lOiBsYW1iZGEuUnVudGltZS5OT0RFSlNfMjBfWCxcclxuICAgICAgaGFuZGxlcjogXCJpbmRleC5oYW5kbGVyXCIsXHJcbiAgICAgIGNvZGU6IGxhbWJkYS5Db2RlLmZyb21Bc3NldChwYXRoLmpvaW4oX19kaXJuYW1lLCBcIi4vc3JjL2dldC1zdWJzY3JpcHRpb25zXCIpKSxcclxuICAgICAgZW52aXJvbm1lbnQ6IHtcclxuICAgICAgICBEWU5BTU9EQl9UQUJMRTogc3Vic2NyaXB0aW9uc0RhdGFUYWJsZS50YWJsZU5hbWUsXHJcbiAgICAgIH0sXHJcbiAgICB9KTtcclxuXHJcbiAgICB0aGlzLnVuc3Vic2NyaWJlRm4gPSBuZXcgbGFtYmRhLkZ1bmN0aW9uKHRoaXMsIFwidW5zdWJzY3JpYmVGblwiLCB7XHJcbiAgICAgIHJ1bnRpbWU6IGxhbWJkYS5SdW50aW1lLk5PREVKU18yMF9YLFxyXG4gICAgICBoYW5kbGVyOiBcImluZGV4LmhhbmRsZXJcIixcclxuICAgICAgY29kZTogbGFtYmRhLkNvZGUuZnJvbUFzc2V0KHBhdGguam9pbihfX2Rpcm5hbWUsIFwiLi9zcmMvdW5zdWJzY3JpYmVcIikpLFxyXG4gICAgICBlbnZpcm9ubWVudDoge1xyXG4gICAgICAgIERZTkFNT0RCX1RBQkxFOiBzdWJzY3JpcHRpb25zRGF0YVRhYmxlLnRhYmxlTmFtZSxcclxuICAgICAgfSxcclxuICAgIH0pO1xyXG5cclxuICAgIHRoaXMuZWRpdE1vdmllRm4gPSBuZXcgbGFtYmRhLkZ1bmN0aW9uKHRoaXMsIFwiZWRpdE1vdmllRm5cIiwge1xyXG4gICAgICBydW50aW1lOiBsYW1iZGEuUnVudGltZS5OT0RFSlNfMjBfWCxcclxuICAgICAgaGFuZGxlcjogXCJpbmRleC5oYW5kbGVyXCIsXHJcbiAgICAgIGNvZGU6IGxhbWJkYS5Db2RlLmZyb21Bc3NldChwYXRoLmpvaW4oX19kaXJuYW1lLCBcIi4vc3JjL2VkaXQtbW92aWVcIikpLFxyXG4gICAgICBlbnZpcm9ubWVudDoge1xyXG4gICAgICAgIFMzX0JVQ0tFVDogbW92aWVzQnVja2V0LmJ1Y2tldE5hbWUsXHJcbiAgICAgICAgRFlOQU1PREJfVEFCTEU6IG1vdmllc0RhdGFUYWJsZS50YWJsZU5hbWUsXHJcbiAgICAgIH0sXHJcbiAgICB9KTtcclxuXHJcbiAgICB0aGlzLnJhdGVNb3ZpZUZuID0gbmV3IGxhbWJkYS5GdW5jdGlvbih0aGlzLCBcInJhdGVNb3ZpZUZuXCIsIHtcclxuICAgICAgcnVudGltZTogbGFtYmRhLlJ1bnRpbWUuTk9ERUpTXzIwX1gsXHJcbiAgICAgIGhhbmRsZXI6IFwiaW5kZXguaGFuZGxlclwiLFxyXG4gICAgICBjb2RlOiBsYW1iZGEuQ29kZS5mcm9tQXNzZXQocGF0aC5qb2luKF9fZGlybmFtZSwgXCIuL3NyYy9yYXRlLW1vdmllXCIpKSxcclxuICAgICAgZW52aXJvbm1lbnQ6IHtcclxuICAgICAgICBNT1ZJRV9SQVRJTkdTX1RBQkxFOiBtb3ZpZVJhdGluZ3NUYWJsZS50YWJsZU5hbWUsXHJcbiAgICAgIH0sXHJcbiAgICB9KTtcclxuXHJcblxyXG4gICAgbW92aWVzQnVja2V0LmdyYW50UmVhZCh0aGlzLmRvd25sb2FkTW92aWVGbik7XHJcbiAgICBtb3ZpZXNCdWNrZXQuZ3JhbnRSZWFkKHRoaXMuZ2V0TW92aWVzRm4pO1xyXG4gICAgbW92aWVzQnVja2V0LmdyYW50UmVhZCh0aGlzLmdldFNpbmdsZU1vdmllRm4pO1xyXG4gICAgbW92aWVzQnVja2V0LmdyYW50UmVhZFdyaXRlKHRoaXMudXBsb2FkTW92aWVGbik7XHJcbiAgICBtb3ZpZXNCdWNrZXQuZ3JhbnRSZWFkV3JpdGUodGhpcy5kZWxldGVNb3ZpZUZuKTtcclxuICAgIG1vdmllc0J1Y2tldC5ncmFudFJlYWRXcml0ZSh0aGlzLmVkaXRNb3ZpZUZuKTtcclxuXHJcbiAgICBtb3ZpZXNEYXRhVGFibGUuZ3JhbnRSZWFkRGF0YSh0aGlzLmRvd25sb2FkTW92aWVGbik7XHJcbiAgICBtb3ZpZXNEYXRhVGFibGUuZ3JhbnRSZWFkRGF0YSh0aGlzLmdldFNpbmdsZU1vdmllRm4pO1xyXG4gICAgbW92aWVzRGF0YVRhYmxlLmdyYW50UmVhZERhdGEodGhpcy5nZXRNb3ZpZXNGbik7XHJcbiAgICBtb3ZpZXNEYXRhVGFibGUuZ3JhbnRSZWFkV3JpdGVEYXRhKHRoaXMudXBsb2FkTW92aWVGbik7XHJcbiAgICBtb3ZpZXNEYXRhVGFibGUuZ3JhbnRSZWFkV3JpdGVEYXRhKHRoaXMuZGVsZXRlTW92aWVGbik7XHJcbiAgICBtb3ZpZXNEYXRhVGFibGUuZ3JhbnRSZWFkV3JpdGVEYXRhKHRoaXMuZWRpdE1vdmllRm4pO1xyXG5cclxuICAgIHN1YnNjcmlwdGlvbnNEYXRhVGFibGUuZ3JhbnRXcml0ZURhdGEodGhpcy5zdWJzY3JpYmVGbik7XHJcbiAgICBzdWJzY3JpcHRpb25zRGF0YVRhYmxlLmdyYW50UmVhZERhdGEodGhpcy5nZXRTdWJzY3JpcHRpb25zRm4pO1xyXG4gICAgc3Vic2NyaXB0aW9uc0RhdGFUYWJsZS5ncmFudFdyaXRlRGF0YSh0aGlzLnVuc3Vic2NyaWJlRm4pO1xyXG5cclxuICAgIG1vdmllUmF0aW5nc1RhYmxlLmdyYW50UmVhZFdyaXRlRGF0YSh0aGlzLnJhdGVNb3ZpZUZuKTtcclxuICAgIG1vdmllUmF0aW5nc1RhYmxlLmdyYW50UmVhZERhdGEodGhpcy5nZXRTaW5nbGVNb3ZpZUZuKTtcclxuICB9XHJcbn1cclxuIl19